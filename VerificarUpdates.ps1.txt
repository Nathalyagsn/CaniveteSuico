# Inicia a mensagem para o usuario
Write-Host --------------------------------------------------------- -ForegroundColor Green
Write-Host  Assistente de Atualizacao do Windows PowerShell
Write-Host --------------------------------------------------------- -ForegroundColor Green
Write-Host 
Write-Host Este processo pode levar varios minutos. Por favor, aguarde. -ForegroundColor Yellow
Write-Host 

# Passo 1 Verifica se o modulo necessario (PSWindowsUpdate) esta instalado.
Write-Host [PASSO 1 de 3] Verificando se o modulo de Update esta instalado... -ForegroundColor Cyan
if (Get-Module -ListAvailable -Name PSWindowsUpdate) {
    Write-Host     - Modulo 'PSWindowsUpdate' ja esta instalado. -ForegroundColor Green
} else {
    Write-Host     - Modulo nao encontrado. Tentando instalar agora... -ForegroundColor Yellow
    
    # Instala o gerenciador de pacotes NuGet se necessario
    Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force -Confirm$false  Out-Null
    
    # Instala o modulo do Windows Update, aceitando a licenca automaticamente
    Install-Module -Name PSWindowsUpdate -Force -AcceptLicense -Confirm$false  Out-Null
    Write-Host     - Modulo instalado com sucesso! -ForegroundColor Green
}

# Importa o modulo para a sessao atual
Import-Module PSWindowsUpdate -ErrorAction SilentlyContinue

# Passo 2 Procura por atualizacoes
Write-Host 
Write-Host [PASSO 2 de 3] Procurando por atualizacoes do Windows... -ForegroundColor Cyan
$updates = Get-WUList -Verbose
if ($null -eq $updates) {
    Write-Host     - Seu sistema ja esta atualizado. Nenhuma acao e necessaria. -ForegroundColor Green
} else {
    Write-Host     - Atualizacoes encontradas! Iniciando download e instalacao... -ForegroundColor Yellow
    
    # Passo 3 Baixa e instala as atualizacoes
    Write-Host 
    Write-Host [PASSO 3 de 3] Baixando e instalando as atualizacoes... -ForegroundColor Cyan
    Get-WUInstall -AcceptAll -AutoReboot -Verbose
    
    Write-Host 
    Write-Host     - Todas as atualizacoes foram instaladas! -ForegroundColor Green
}

Write-Host 
Write-Host --------------------------------------------------------- -ForegroundColor Green
Write-Host Verificacao concluida. Pressione ENTER para voltar ao menu.
Read-Host